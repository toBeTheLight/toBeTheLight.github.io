---
layout: post
title:  "阅读：计算机网络教程（2）应用层"
categories: 阅读笔记 计算机网络
tags:  计算机网络 套接字
author: toBeTheLight
---

* content
{:toc}
整个因特网、硬件以及软件的设计和开发就是为应用层提供服务。TCP/IP协议簇的第五层正是这些服务的所在位置。其他四层协议使这些服务成为可能。




# 2.1 介绍

应用层的通信是由逻辑连接提供的。两台主机之间“有”一条假象的双向逻辑信道，可以通过这条信道发送接收报文。实际上通信通过了若干设备和若干物理信道。

## 2.1.1 提供服务

* 早期开始运营的所有通信网络大多都被设计为提供一种特定服务，如电话网络。
* TCP／IP协议簇的层次结构使得因特网比其他网络更加灵活。协议簇的每一层原先又一个或多个协议组成，但是可以加入新的协议。
* 加入的新协议应当被设计成使用底层协议提供的服务，删去协议时，因为其上层可能使用了它提供的服务，应改写其上层协议。应用层位于协议簇的最高层，所以可以较为轻易的被删除或添加。
* 由于位于最高层，应用层是唯一向因特网用户提供服务的层次。
* TCP／IP协议簇的前四层所用的协议通常成为包的一部分（包含在windows/UNIX里），所以前四层所使用的协议需要标准化和归档。
* 每个标准协议是一对程序，与用户和传输层进行交互。同样，可以写两个程序做为非标准协议。

# 2.1.2 应用层模型

* 传统模式：客户-服务器
* 新模式：对等
* 混合模式

# 2.2 客户-服务器模式

应用层的通信在两个运行着的应用程序之间，称为客户进程和服务器进程。服务器进程需要一直运行等待客户，客户进程通常发送有限的请求，接收响应然后停止。

## 2.2.1 应用程序接口

* 计算机程序通常是由预定义了指令集的计算机语言编写的，这个指令集告诉计算机要做什么。
* 这样的指令集通常成为应用程序接口（Application Programming Interface）API。
* 通信API有三个很常见：套接字接口、传输层接口、STREAM。

### 套接字

* 套接字接口是提供应用层和操作系统之间通信的指令集。
* 套接字是提供应用程序创建和使用的数据结构。
* 就应用层而言，客户进程和服务器进程之间的通信是两个套接字间的通信。
* 客户认为套接字是接收请求和给出响应的实体，服务器认为套接字是发出请求并且需要获得相应的实体。（此处可以理解为服务器接口地址和主机地址）

### 套接字地址

* 客户和服务端是双向通信的，我们需要一对地址：本地地址和远程地址。
* 由于客户-服务器模式的通信是在套接字之间的，我们需要一对套接字地址。
* 我们需要用TCP/IP协议簇的标识符来定义套接字地址。
* 套接字地址应该是IP地址+端口号的组合。

### 寻找套接字地址

服务器和客户站点都需要一个本地（服务器／客户）和一个远程（客户／服务器）套接字地址来通信。

* 服务器站点
    * 本地（服务器）套接字地址由操作系统提供。操作系统知道运行着服务器进程的计算机IP，端口号则需要被分配。标准进程一般都固定端口号，非标准进程则在设计时指定。
    * 远程（客户套）套接字地址包含在发送给服务器的请求报文中。

* 客户站点
    * 本地（客户）套接字地址也由操作系统提供。操作系统知道运行着客户进程的计算机的IP地址。而端口号是每次进行通信时分配给客户进程的一个临时16位整数。
    * 使用IP地址进行通信时我们知道远程套（服务器）接字地址。使用如域名、邮件地址（应用层标识符）进行通信时，需要通过域名系统DNS（Domain Name System）解析获得IP地址，而端口号客户进程通常知道。

## 2.2.2 使用传输层的服务

由于应用层没物理通信，这一对进程需要使用传输层提供的服务来通信。对传输层协议的选择将严重影响应用进程的性能。常见传输层协议有：UDP、TCP、SCTP。

* UDP：提供了无连接的、不可靠的数据包服务。
    * 两个交换报文的终端之间没有逻辑连接。
    * 每个报文都是独立的实体，被封装在一个称为数据报的分组中。
    * 无法得知发送是否完整安全到达。
* TCP：提供了面向连接的可靠的字节流传输。
    * 两个终端首先通过交换一些连接建立分组来建立一个逻辑连接，有时称为**握手**。
    * 建立连接后，两个终端可以向彼此的方向以报文段形式发送数据块，检测字节的连续性，在字节丢失和损坏时可要求重发。
* SCTP：组合UDP和TCP。
    * 面向报文的，面向连接的可靠的服务。
    * 可以通过提供多媒体网络层连接提供多媒体流服务。

# 2.3 标准客户-服务器应用

介绍6个标准应用：HTTP和万维网、文件传输和电子邮件应用、通过TELNET和SSH协议实现远程登录、DNS。

## 2.3.1 万维网和HTTP

与web相关的最常见的客户-服务器应用程序。

### 万维网

* web的流行和两个术语有关：分布式的和链接的。
* 分布式允许web增长。链接使使得一个网页与另一个存储在世界某个地方的主机上的网页相互引用。
* 网页的链接通过使用一个称为超文本（hypertext）的概念而实现。

### 结构

* WWW是一个分布式客户-服务器服务。
* 服务分布在很多称为站点（site）的地点上。
* 每个站点上有一个或多个文档，称为网页。
* 每个网页可以包含一些到其他网页的链接。

### 网络客户（浏览器）

* 每个浏览器通常包含三部分：控制程序，客户协议和解释程序。
* 控制程序接收来自键盘和鼠标的输入并使用客户端程序来访问文档。
* 访问后，控制程序使用解释程序来显示文档。

### 网络服务器

网页时存储在服务器上的，为了提高效率，服务器通常将被请求的文件存储在内存的缓存中。

* 统一资源定位符（Uniform Resource Locator， Url）
为了定义一个网页，我们需要三个标识符：主机、端口、路径。在定义网页之前，我们需要告知浏览器我们想使用哪个客户-服务器应用，这称为协议。形式通常位`protocol://host:port/path`，port默认可省略。
    * 协议：这个标识符是我们使用的来访问网页的客户-服务器程序的缩写。
    * 主机：主机标识符可以是服务器的IP地址或主机被给予的唯一名称。IP地址可以按点分割的十进制数表示法定义。名称通常是唯一定义主机的域名。
    * 端口：端口是一个16位整数，通常为客户-服务器应用预定义。如http默认80，否则将会被显示。
    * 地址：定义了下层的操作系统中文件的位置和名称。

* 网上文档：可分为三大类，静态文档／动态文档／活动文档。
    * 静态文档：在服务器中创建和存储的固定内容的文档。用户不能改变他们，通常使用html、xhtml、xsl等编写。
    * 动态文档：对每个请求都要创建一个全新的文档，因此动态文档的内容随着请求不同而不同。使用jsp、phtml、asp等编写。
    * 活动文档：创建工作移到浏览器端，如使用javascript在浏览器端生成。

### 超文本传输协议（HTTP）

用来定义客户服务器程序如何编写和如何从万维网获取网页的协议。一个HTTP客户发送一个请求；HTTP服务器返回响应。服务器使用80端口，客户使用一个临时的端口号。HTTP使用TCP传输层服务。意味着进行任何事务之前，服务器和客户之间必须建立连接，事务之后连接应当终止。

#### 非持续与持续连接

当要获取的对象位于同一台服务器，我们可以每次使用一个全新的TCP连接来获取一个对象，也可以创建一个TCP链接获取全部对象。分别称为非持续连接和持续连接，在HTTP1.1之后持续连接是默认的。

* 非持续链接
    1. 客户开启一个TCP连接并发送请求。
    2. 服务器发送响应并关闭连接。
    3. 客户读取数据直到它遇到了文件结束标记，然后关闭连接。

    如果文件包含了N个位于不同文件的图片连接（位于同一服务器），那么就必须开启和关闭N+1次。会有高额开销（握手时间、缓冲区、变量等）。
* 持续链接
    * 服务器在发送一个响应后，为响应更多的请求儿将连接置为打开状态。
    * 服务器可以在客户的请求下或超时情况下将连接关闭。

#### 报文格式

HTTP协议定义了请求报文和响应报文的格式。每一种报文由四部分组成。请求报文的第一部分称为请求行，响应报文的第一部分称为状态行。其他三部分都称为首部行，空行和主体。

* 请求报文
    * 请求行：请求报文的第一行，由三部分由空格隔开并且被两个字符（回车和换行）终止。这些字段称为方法、URL、版本。
        * 方法字段：定义了请求类型。
        
            |类型|作用|特征|
            |:--:|:--:|:--:|
            |get||报文主体是空的|
            |head|获取网页信息|响应报文只有头部，主体是空的|
            |put|讲一个新的页面发送到服务器||
            |post|发送信息到服务器，用于加入网页或修改网页||
            |trace|用于调试||
            |delete|用于删除服务器上的网页||
            |options|允许客户询问网页属性||

        * url：定义了相关网页的地址和名称。
        * 版本：给出协议的版本
    * 请求头部：可以有一个或多个请求头部行。每一个头部都从客户端向服务器发送格外信息。每个头部行有头部名字、一个冒号、一个空格和一个头部值。
    * 主体：出现在请求报文中，通常使用post和put时，包含要发送的评论和发布到网站上的文档。

* 响应报文
    * 状态行：响应报文的第一行，有空格分割并且被两个字符（回车和换行）种植。有三个字端：版本、状态码、短语。
        * 版本：HTTP协议的版本。
        * 状态码：定义了请求的状态。
        
            |状态码|含义|
            |:--:|:--:|
            |100范围|代表一个报告，代表请求已被接受，需要继续处理|
            |200范围|表示这是成功的请求|
            |300范围|表示客户端重定向到另一个URL，客户端采取进一步的操作才能完成请求|
            |400范围|通常是在客户端发生了错误|
            |500范围|通常代表了服务器在处理请求的过程中有错误或者异常状态发生|
        * 短语：文本格式解释了状态码。
    * 响应头：可以有一个或多个响应头部行。每一个头部行都从服务器向客户端发送额外的信息。每个头部行都有一个头部名称、一个冒号、一个空格和一个头部值。
    * 主体：包好了从服务器发送给客户的文档，除非响应是一个错误报文，否则主体是存在的。

* 条件请求：客户可以在请求中加入条件，如果条件满足，服务器将会发送被请求的网页或者通知用户。
    * Cookie：
