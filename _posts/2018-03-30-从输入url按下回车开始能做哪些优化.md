---
layout: post
title:  "从输入url按下回车开始能做哪些优化"
categories: Web性能
tags:  Web性能
author: toBeTheLight
---

* content
{:toc}




# 参考
* 《计算机网络自顶向下方法》
* [老生常谈-从输入url到页面展示到底发生了什么](https://www.cnblogs.com/xianyulaodi/p/6547807.html)
* [what happens when you type in a URL in browser](https://stackoverflow.com/questions/2092527/what-happens-when-you-type-in-a-url-in-browser)
* [“天龙八步”细说浏览器输入URL后发生了什么](http://www.xuecaijie.com/it/157.html)
* [DNS解析的过程是什么，求详细的？](https://www.zhihu.com/question/23042131)
* [前端性能优化最佳实践](https://csspod.com/frontend-performance-best-practices/)

# DNS 域名解析

一般来讲，我们输入的url是域名，而为了识别一个实体，TCP/IP使用IP地址来唯一确定一台主机到因特网的连接，DNS会帮助我们完成域名到IP地址映射的工作。以`www.aaa.com`为例，解析过程大致如下：

## 过程

* 浏览器
  * 浏览器查询浏览器缓存，没有。

* 本机层
  * 浏览器客户端向系统询问服务器IP地址，调用本机内的DNS解析程序，检查自己本地的hosts文件是否有这个域名映射关系，没有。
  * 查找本机的DNS解析器缓存，没有。

* 路由器缓存
  * 可能还存在路由器缓存这一层

* 本地DNS服务器
  * 本机的DNS解析程序向本地的DNS服务器发起请求，一般为TCP/IP参数中设置的首选DNS服务器。
  * 本地DNS服务器会根据是否设置转发器判断是向上一级DNS服务器（其解析规则同理）还是直接向根DNS服务器（知道根DNS服务器的IP地址）发送请求。

* 与DNS服务器
  * 收到请求后，根DNS服务器并不直接解析地址，但是知道每个顶级域中的一台服务器的地址（如com 域名服务器）。如果为迭代查询方式，此顶级域DNS服务器的ip被返回给本地DNS服务器。
  * 本地DNS服务器提取到顶级域DNS服务器信息后，会再向其发出请求。顶级域DNS服务器收到请求后，会先查询自己的缓存，没有，则将负责的二级域名服务器（如aaa.com）返回给本地DNS服务器，以此类推直到查到目标域名的映射信息或查询失败。
  * 查到映射信息后返回回到本机，中间会进行缓存。

* 查询方式：
  * 递归方式：一路查下去中间不返回，得到最终结果才返回信息。
  * 迭代方式：上面的本地DNS服务器与其他域名服务器直接的查询方式。
  * 一般默认的方式从本机到本地DNS服务器是递归，DNS服务器之间是迭代查询。

## 优化

当然针对DNS的优化就是减少DNS解析的时间，由于浏览器缓存机制的存在，我们只需要对首次访问进行优化，即适当减少要解析的域名个数，考虑到其他优化机制可以将页面及资源分布到2-4个域名上。

# 建立TCP连接

好了，浏览器终于拿到服务器IP了，客户端想要与服务器间通信并传递消息需要开启TCP（一种传输层协议）连接。

## 过程